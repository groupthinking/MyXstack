name: PR Checks
on:
  pull_request:
    types: [opened, reopened, synchronize, edited]
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const issues = [];

            if (pr.title.length < 10) {
              issues.push('‚ùå PR title too short (minimum 10 characters)');
            }
            if (!/^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:/.test(pr.title)) {
              issues.push('‚ö†Ô∏è PR title should follow conventional commits format');
            }

            if (!pr.body || pr.body.length < 20) {
              issues.push('‚ùå PR description is required (minimum 20 characters)');
            }

            const totalChanges = (pr.additions || 0) + (pr.deletions || 0);
            if (totalChanges > 500) {
              issues.push(`‚ö†Ô∏è Large PR detected (${totalChanges} lines changed)`);
            }

            if (issues.length > 0) {
              const comment = `## üîç PR Validation\n\n${issues.join('\n')}`;
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                body: comment
              });
              core.setFailed('PR validation failed');
            }
