name: PR Checks
on:
  pull_request:
    types: [opened, reopened, synchronize, edited]
permissions:
  pull-requests: read
  issues: write
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const errors = [];
            const warnings = [];

            if (pr.title.length < 10) {
              errors.push('âŒ PR title too short (minimum 10 characters)');
            }
            if (!/^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:/.test(pr.title)) {
              warnings.push('âš ï¸ PR title should follow conventional commits format');
            }

            if (!pr.body || pr.body.length < 20) {
              errors.push('âŒ PR description is required (minimum 20 characters)');
            }

            const totalChanges = (pr.additions || 0) + (pr.deletions || 0);
            if (totalChanges > 500) {
              warnings.push(`âš ï¸ Large PR detected (${totalChanges} lines changed)`);
            }

            const allMessages = [...errors, ...warnings];
            if (allMessages.length > 0) {
              const comment = `## ðŸ” PR Validation\n\n${allMessages.join('\n')}`;
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                body: comment
              });
              if (errors.length > 0) {
                core.setFailed('PR validation failed');
              }
            }
